package pkg

import "testing"

func TestPlanEnricher_AnalyzePlan(t *testing.T) {
	type fields struct {
		ctes            map[string]Node
		containsBuffers bool
	}
	type args struct {
		plan string
	}
	tests := []struct {
		name   string
		fields fields
		args   args
	}{
		{
			name: "test",
			fields: fields{
				ctes:            nil,
				containsBuffers: false,
			},
			args: args{
				plan: `[{"Plan":{"Actual Loops":1,"Actual Rows":11,"Actual Startup Time":14061.801,"Actual Total Time":14061.82,"Node Type":"Limit","Plans":[{"Actual Loops":1,"Actual Rows":11,"Actual Startup Time":14061.799,"Actual Total Time":14061.815,"Node Type":"Sort","Plans":[{"Actual Loops":1,"Actual Rows":11,"Actual Startup Time":14061.687,"Actual Total Time":14061.713,"Node Type":"HashAggregate","Plans":[{"Actual Loops":1,"Actual Rows":11,"Actual Startup Time":0.084,"Actual Total Time":14061.342,"Node Type":"Append","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.083,"Actual Total Time":0.091,"Node Type":"Limit","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.082,"Actual Total Time":0.089,"Node Type":"Sort","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.069,"Actual Total Time":0.076,"Node Type":"Nested Loop Semi Join","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.057,"Actual Total Time":0.061,"Node Type":"Nested Loop Join","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.042,"Actual Total Time":0.044,"Node Type":"Nested Loop","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.018,"Actual Total Time":0.019,"Index Name":"activity_events_resource_id_idx","Node Type":"Index Scan","Plan Rows":1,"Total Cost":8.45,"Relation Name":"object_service.activity_events","Startup Cost":0.42,"Plan Width":297,"Output":"activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.message, activity_events.context, activity_events.related_association_ids, activity_events.related_object_ids, activity_events.created_at, activity_events.created_by, activity_events.resource_id, activity_events.resource_type","Index Cond":"(activity_events.resource_id = '919da7ab-0a6a-49eb-bdcb-d2011ba85976'::uuid)","Filter":"(((activity_events.resource_type)::text = 'object'::text) AND (activity_events.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid))","Shared Hit Blocks":4,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.02,"Actual Total Time":0.021,"Index Name":"objects_pkey","Node Type":"Index Scan","Plan Rows":1,"Total Cost":8.45,"Relation Name":"object_service.objects","Startup Cost":0.43,"Plan Width":1090,"Output":"objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by","Index Cond":"(objects.id = '919da7ab-0a6a-49eb-bdcb-d2011ba85976'::uuid)","Filter":"(objects.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid)","Shared Hit Blocks":4,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Total Cost":16.91,"Startup Cost":0.85,"Plan Width":1387,"Output":"activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by","Shared Hit Blocks":8,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":0,"Actual Startup Time":0.014,"Actual Total Time":0.014,"Index Name":"associations_pkey","Node Type":"Index Scan","Plan Rows":1,"Total Cost":8.58,"Relation Name":"object_service.associations","Startup Cost":0.56,"Plan Width":304,"Output":"associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Index Cond":"(associations.id = '919da7ab-0a6a-49eb-bdcb-d2011ba85976'::uuid)","Filter":"(associations.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid)","Shared Hit Blocks":4,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Total Cost":25.51,"Join Type":"Left","Startup Cost":1.42,"Plan Width":1691,"Output":"activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Inner Unique":"true","Join Filter":"(((activity_events.resource_type)::text = 'association'::text) AND (activity_events.resource_id = associations.id))","Shared Hit Blocks":12,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.01,"Actual Total Time":0.011,"Index Name":"objects_pkey","Node Type":"Index Scan","Plan Rows":1,"Total Cost":8.45,"Relation Name":"object_service.objects","Alias":"objects_1","Startup Cost":0.43,"Plan Width":16,"Output":"objects_1.id, objects_1.org_id, objects_1.object_type, objects_1.index, objects_1.properties, objects_1.created_at, objects_1.created_by, objects_1.updated_at, objects_1.updated_by, objects_1.archived_at, objects_1.archived_by","Index Cond":"(objects_1.id = '919da7ab-0a6a-49eb-bdcb-d2011ba85976'::uuid)","Filter":"((objects_1.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid) AND ((objects_1.object_type)::text = 'poggio/core/emailMessage'::text))","Shared Hit Blocks":4,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Total Cost":33.97,"Startup Cost":1.85,"Plan Width":1851,"Output":"'event'::text, activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, NULL::character varying, NULL::jsonb, NULL::jsonb, NULL::jsonb, objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Shared Hit Blocks":16,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Total Cost":33.98,"Startup Cost":33.98,"Plan Width":1851,"Output":"'event'::text, activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, NULL::character varying, NULL::jsonb, NULL::jsonb, NULL::jsonb, objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Sort Key":["activity_events.ts DESC NULLS LAST","activity_events.id DESC"],"Sort Method":"quicksort","Sort Space Used":"29","Sort Space Type":"Memory","Shared Hit Blocks":16,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Total Cost":33.98,"Startup Cost":33.98,"Plan Width":1851,"Output":"'event'::text, activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, NULL::character varying, NULL::jsonb, NULL::jsonb, NULL::jsonb, objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Shared Hit Blocks":16,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":10,"Actual Startup Time":290.431,"Actual Total Time":14061.241,"Node Type":"Limit","Plans":[{"Actual Loops":1,"Actual Rows":10,"Actual Startup Time":290.429,"Actual Total Time":14061.234,"Node Type":"Nested Loop Join","Plans":[{"Actual Loops":1,"Actual Rows":1378008,"Actual Startup Time":0.039,"Actual Total Time":7557.937,"Node Type":"Nested Loop Join","Plans":[{"Actual Loops":1,"Actual Rows":1378008,"Actual Startup Time":0.025,"Actual Total Time":759.996,"Index Name":"activity_mutations_org_order_by_ts_id_idx","Node Type":"Index Scan","Plan Rows":1489107,"Total Cost":3326339.2,"Relation Name":"object_service.activity_mutations","Startup Cost":0.57,"Plan Width":552,"Output":"activity_mutations.id, activity_mutations.org_id, activity_mutations.ts, activity_mutations.actor, activity_mutations.source, activity_mutations.operation, activity_mutations.resource_type, activity_mutations.resource_id, activity_mutations.properties_before, activity_mutations.properties_after, activity_mutations.created_at, activity_mutations.created_by, activity_mutations.context","Index Cond":"(activity_mutations.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid)","Shared Hit Blocks":771380,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0},{"Actual Loops":1378008,"Actual Rows":1,"Actual Startup Time":0.004,"Actual Total Time":0.004,"Index Name":"objects_pkey","Node Type":"Index Scan","Plan Rows":1,"Total Cost":4.38,"Relation Name":"object_service.objects","Alias":"objects_2","Startup Cost":0.43,"Plan Width":1090,"Output":"objects_2.id, objects_2.org_id, objects_2.object_type, objects_2.index, objects_2.properties, objects_2.created_at, objects_2.created_by, objects_2.updated_at, objects_2.updated_by, objects_2.archived_at, objects_2.archived_by","Index Cond":"(objects_2.id = activity_mutations.resource_id)","Filter":"(objects_2.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid)","Shared Hit Blocks":5160866,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1489107,"Total Cost":9860979.19,"Join Type":"Left","Startup Cost":1,"Plan Width":1642,"Output":"activity_mutations.id, activity_mutations.org_id, activity_mutations.ts, activity_mutations.actor, activity_mutations.source, activity_mutations.resource_type, activity_mutations.resource_id, activity_mutations.created_at, activity_mutations.created_by, activity_mutations.operation, activity_mutations.properties_before, activity_mutations.properties_after, activity_mutations.context, objects_2.id, objects_2.org_id, objects_2.object_type, objects_2.index, objects_2.properties, objects_2.created_at, objects_2.created_by, objects_2.updated_at, objects_2.updated_by, objects_2.archived_at, objects_2.archived_by","Inner Unique":"true","Join Filter":"((activity_mutations.resource_type)::text = 'object'::text)","Shared Hit Blocks":5932249,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0},{"Actual Loops":1378008,"Actual Rows":0,"Actual Startup Time":0.004,"Actual Total Time":0.004,"Index Name":"associations_pkey","Node Type":"Index Scan","Plan Rows":1,"Total Cost":4.69,"Relation Name":"object_service.associations","Alias":"associations_1","Startup Cost":0.56,"Plan Width":304,"Output":"associations_1.id, associations_1.org_id, associations_1.from_object_type, associations_1.to_object_type, associations_1.from_object_id, associations_1.to_object_id, associations_1.properties, associations_1.created_at, associations_1.created_by, associations_1.updated_at, associations_1.updated_by, associations_1.archived_at, associations_1.archived_by","Index Cond":"(associations_1.id = activity_mutations.resource_id)","Filter":"(associations_1.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid)","Shared Hit Blocks":5677585,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":2,"Actual Startup Time":0.021,"Actual Total Time":0.031,"Index Name":"associations_pkey","Node Type":"Index Scan","Plan Rows":1,"Subplan Name":"SubPlan 1","Total Cost":17.17,"Relation Name":"object_service.associations","Alias":"associations_2","Startup Cost":0.56,"Plan Width":16,"Parent Relationship":"SubPlan","Output":"associations_2.id","Index Cond":"(associations_2.id = ANY ('{9f46a3a8-f08d-4dc1-9e88-625155da5e40,23a5c6cb-24d1-479e-8177-a5d20b7563af}'::uuid[]))","Filter":"((associations_2.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid) AND ((associations_2.from_object_type)::text = 'poggio/core/contact'::text) AND ((associations_2.to_object_type)::text = 'poggio/core/account'::text))","Shared Hit Blocks":10,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":4,"Actual Startup Time":0.051,"Actual Total Time":0.062,"Node Type":"Bitmap Heap Scan","Plans":[{"Actual Loops":1,"Actual Rows":0,"Actual Startup Time":0.044,"Actual Total Time":0.046,"Node Type":"BitmapOr","Plans":[{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.006,"Actual Total Time":0.007,"Index Name":"objects_pkey","Node Type":"Bitmap Index Scan","Plan Rows":1,"Total Cost":4.44,"Startup Cost":0,"Plan Width":0,"Index Cond":"(objects_3.id = 'b7e5c9c2-a382-4b5e-85e2-a9923d073d98'::uuid)","Shared Hit Blocks":3,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":2,"Actual Startup Time":0.031,"Actual Total Time":0.031,"Index Name":"objects_id_org_id_object_type_unique","Node Type":"Bitmap Index Scan","Plan Rows":1,"Total Cost":8.88,"Startup Cost":0,"Plan Width":0,"Index Cond":"((objects_3.id = ANY ('{2d159b33-409b-40a7-adf4-c98d30d887f9,51c20ffc-8ed0-4f9a-8f70-466d25f7f2ed}'::uuid[])) AND (objects_3.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid) AND ((objects_3.object_type)::text = 'poggio/core/contact'::text))","Shared Hit Blocks":6,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0},{"Actual Loops":1,"Actual Rows":1,"Actual Startup Time":0.005,"Actual Total Time":0.005,"Index Name":"objects_pkey","Node Type":"Bitmap Index Scan","Plan Rows":1,"Total Cost":4.44,"Startup Cost":0,"Plan Width":0,"Index Cond":"(objects_3.id = '6e438383-869c-4fe3-9392-aa364544afc6'::uuid)","Shared Hit Blocks":3,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"Shared Identifier: Blocks":null,"Shared 2618886609364533220planning: Blocks":null}],"Plan Rows":2,"Total Cost":17.76,"Startup Cost":17.76,"Plan Width":0,"Shared Hit Blocks":12,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1,"Subplan Name":"SubPlan 2","Total Cost":25.81,"Relation Name":"object_service.objects","Alias":"objects_3","Startup Cost":17.76,"Plan Width":16,"Parent Relationship":"SubPlan","Output":"objects_3.id","Recheck Cond":"((objects_3.id = 'b7e5c9c2-a382-4b5e-85e2-a9923d073d98'::uuid) OR ((objects_3.id = ANY ('{2d159b33-409b-40a7-adf4-c98d30d887f9,51c20ffc-8ed0-4f9a-8f70-466d25f7f2ed}'::uuid[])) AND (objects_3.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid) AND ((objects_3.object_type)::text = 'poggio/core/contact'::text)) OR (objects_3.id = '6e438383-869c-4fe3-9392-aa364544afc6'::uuid))","Filter":"((objects_3.org_id = 'd9cb3b72-d3e8-46c0-8ed4-00c9eea5089e'::uuid) AND ((((objects_3.object_type)::text = 'poggio/core/account'::text) AND (objects_3.id = 'b7e5c9c2-a382-4b5e-85e2-a9923d073d98'::uuid)) OR (((objects_3.object_type)::text = 'poggio/core/contact'::text) AND (objects_3.id = ANY ('{2d159b33-409b-40a7-adf4-c98d30d887f9,51c20ffc-8ed0-4f9a-8f70-466d25f7f2ed}'::uuid[]))) OR (((objects_3.object_type)::text = 'poggio/core/note'::text) AND (objects_3.id = '6e438383-869c-4fe3-9392-aa364544afc6'::uuid))))","Heap Blocks":"exact=4","Shared Hit Blocks":16,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0}],"Plan Rows":1116830,"Rows Removed by Filter":1377998,"Total Cost":16867322.37,"Join Type":"Left","Startup Cost":44.55,"Plan Width":2042,"Output":"'mutation'::text, activity_mutations.id, activity_mutations.org_id, activity_mutations.ts, activity_mutations.actor, activity_mutations.source, activity_mutations.resource_type, activity_mutations.resource_id, activity_mutations.created_at, activity_mutations.created_by, NULL::text, NULL::jsonb, activity_mutations.operation, activity_mutations.properties_before, activity_mutations.properties_after, activity_mutations.context, objects_2.id, objects_2.org_id, objects_2.object_type, objects_2.index, objects_2.properties, objects_2.created_at, objects_2.created_by, objects_2.updated_at, objects_2.updated_by, objects_2.archived_at, objects_2.archived_by, associations_1.id, associations_1.org_id, associations_1.from_object_type, associations_1.to_object_type, associations_1.from_object_id, associations_1.to_object_id, associations_1.properties, associations_1.created_at, associations_1.created_by, associations_1.updated_at, associations_1.updated_by, associations_1.archived_at, associations_1.archived_by","Inner Unique":"true","Join Filter":"((activity_mutations.resource_type)::text = 'association'::text)","Filter":"((hashed SubPlan 1) OR (hashed SubPlan 2))","Shared Hit Blocks":11610671,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0}],"Plan Rows":18,"Total Cost":316.4,"Startup Cost":44.55,"Plan Width":2042,"Output":"'mutation'::text, activity_mutations.id, activity_mutations.org_id, activity_mutations.ts, activity_mutations.actor, activity_mutations.source, activity_mutations.resource_type, activity_mutations.resource_id, activity_mutations.created_at, activity_mutations.created_by, NULL::text, NULL::jsonb, activity_mutations.operation, activity_mutations.properties_before, activity_mutations.properties_after, activity_mutations.context, objects_2.id, objects_2.org_id, objects_2.object_type, objects_2.index, objects_2.properties, objects_2.created_at, objects_2.created_by, objects_2.updated_at, objects_2.updated_by, objects_2.archived_at, objects_2.archived_by, associations_1.id, associations_1.org_id, associations_1.from_object_type, associations_1.to_object_type, associations_1.from_object_id, associations_1.to_object_id, associations_1.properties, associations_1.created_at, associations_1.created_by, associations_1.updated_at, associations_1.updated_by, associations_1.archived_at, associations_1.archived_by","Shared Hit Blocks":11610671,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0}],"Plan Rows":19,"Total Cost":350.66,"Startup Cost":33.98,"Plan Width":7736,"Shared Hit Blocks":11610687,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0}],"Plan Rows":19,"Total Cost":352.75,"Startup Cost":352.56,"Plan Width":7736,"Output":"('event'::text), activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, (NULL::character varying), (NULL::jsonb), (NULL::jsonb), (NULL::jsonb), objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Group Key":"('event'::text), activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, (NULL::character varying), (NULL::jsonb), (NULL::jsonb), (NULL::jsonb), objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Batches":1,"Shared Hit Blocks":11610731,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0}],"Plan Rows":19,"Total Cost":353.2,"Startup Cost":353.16,"Plan Width":7736,"Output":"('event'::text), activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, (NULL::character varying), (NULL::jsonb), (NULL::jsonb), (NULL::jsonb), objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Sort Key":["activity_events.ts DESC NULLS LAST","activity_events.id DESC"],"Sort Method":"quicksort","Sort Space Used":"47","Sort Space Type":"Memory","Shared Hit Blocks":11610737,"Shared Read Blocks":26,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0}],"Plan Rows":18,"Total Cost":353.2,"Startup Cost":353.16,"Plan Width":7736,"Output":"('event'::text), activity_events.id, activity_events.org_id, activity_events.ts, activity_events.actor, activity_events.source, activity_events.resource_type, activity_events.resource_id, activity_events.created_at, activity_events.created_by, activity_events.message, activity_events.context, (NULL::character varying), (NULL::jsonb), (NULL::jsonb), (NULL::jsonb), objects.id, objects.org_id, objects.object_type, objects.index, objects.properties, objects.created_at, objects.created_by, objects.updated_at, objects.updated_by, objects.archived_at, objects.archived_by, associations.id, associations.org_id, associations.from_object_type, associations.to_object_type, associations.from_object_id, associations.to_object_id, associations.properties, associations.created_at, associations.created_by, associations.updated_at, associations.updated_by, associations.archived_at, associations.archived_by","Shared Hit Blocks":1088,"Shared Read Blocks":0,"Shared Written Blocks":0,"Shared Dirtied Blocks":0,"I/O Read Time":8.257,"I/O Write Time":0},"Planning Time":5.694,"Execution Time":14062.745}]`,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			ps := &PlanEnricher{
				ctes:            tt.fields.ctes,
				containsBuffers: tt.fields.containsBuffers,
			}
			node, err := GetRootNodeFromPlans(tt.args.plan)
			if err != nil {
				t.Fatal(err)
			}
			ps.AnalyzePlan(node)
		})
	}
}
